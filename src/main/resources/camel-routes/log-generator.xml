<route id="xml-log-generator">
    <from uri="rest:post:log-generator"/>

    <setHeader name="logFile"><jsonpath suppressExceptions="true">$.logFile</jsonpath></setHeader>
    <setHeader name="severity"><jsonpath suppressExceptions="true">$.severity</jsonpath></setHeader>
    <setHeader name="message"><jsonpath suppressExceptions="true">$.message</jsonpath></setHeader>
    <setHeader name="iterations"><jsonpath suppressExceptions="true">$.iterations</jsonpath></setHeader>

    <setHeader name="content-type">
        <simple>application/json</simple>
    </setHeader>

    <loop>
        <simple>${headers.iterations}</simple>
        <setBody>
            <simple>${date:now:yyyy-MM-dd HH:mm:ss.SSSZ} ${headers.severity} Count-${headers.CamelLoopIndex} ${headers.message}\n</simple>
        </setBody>
        <toD uri="file:./data/logs?fileName=${headers.logFile}&amp;fileExist=Append" />
        <delay>
            <constant>100</constant>
        </delay>
        <setHeader name="loopCount">
            <simple>${headers.CamelLoopIndex}</simple>
        </setHeader>
    </loop>

    <setBody>
        <simple>
            {
                "message": "Logs generated - ${headers.loopCount}"
            }
        </simple>
    </setBody>

</route>
